<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <meta name="description" content="Track your workouts and progress with Google Sheets">
    <meta name="theme-color" content="#667eea">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="app-icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="app-icon-512.png">
    <link rel="apple-touch-icon" href="app-icon-192.png">
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <!-- Enhanced Cache and Auth Managers -->
    <script src="cache-manager.js"></script>
    <script src="auth-manager.js"></script>

    <script>
        (function() {
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = savedTheme || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
    })();
    </script>
</head>
<body>
    <div class="container">
        <div class="theme-switch-wrapper">
            <label class="theme-switch">
                <input type="checkbox" id="themeToggle">
                <span class="slider"></span>
            </label>
        </div>
        <header>
            
            <h1>üèãüèΩ‚Äç‚ôÄÔ∏è Workout Tracker</h1>
            <div class="sync-status" id="sync-status">
                <span id="sync-indicator">‚ö™</span>
                <span id="sync-text">Not Connected</span>
            </div>
            <div style="margin-bottom: 15px;">
                <div id="session-btn-container">
                    <button id="session-btn" style="width: auto; padding: 10px 20px; margin: 0; display: none;">New Session</button>
                    <div id="google-signin-button-header"></div>
                </div>
            </div>
            <div class="nav-tabs">
                <button class="tab-btn active" data-tab="track">Workout</button>
                <button class="tab-btn" data-tab="history">History</button>
                <button class="tab-btn" data-tab="config">‚öôÔ∏è Settings</button>
                <button class="tab-btn" data-tab="plan">Plan Mode</button>
                <button class="tab-btn" data-tab="followers">Followers</button>
            </div>
        </header>

        <!-- App Purpose Section (always visible) -->
        <div id="app-purpose-section" class="app-purpose-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; margin: 20px 0; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <h2 style="margin-top: 0; margin-bottom: 20px; font-size: 28px; font-weight: 700;">Application Purpose</h2>
            <p style="font-size: 20px; line-height: 1.8; margin-bottom: 25px; font-weight: 600; background: rgba(255, 255, 255, 0.2); padding: 20px; border-radius: 8px; border-left: 4px solid white;">
                <strong>Workout Tracker</strong> is a web-based fitness tracking application that allows users to log, monitor, and analyze their workout sessions. This application enables users to record exercises, sets, reps, weights, and track their fitness progress over time. All workout data is stored in Google Sheets files that are automatically created in the user's own Google Drive, ensuring users maintain complete control and ownership of their fitness data.
            </p>
            <p style="font-size: 16px; line-height: 1.6; margin-bottom: 15px;">
                <strong>Key Features:</strong> This web application provides the following functionality:
            </p>
            <ul style="font-size: 16px; line-height: 1.8; margin-left: 20px; margin-bottom: 15px;">
                <li><strong>Track Workouts:</strong> Log your exercises, sets, reps, and weights for each workout session</li>
                <li><strong>Create Workout Plans:</strong> Build custom workout plans with multiple exercises that you can follow during your training sessions</li>
                <li><strong>Monitor Progress:</strong> View your workout history and visualize your progress over time with interactive graphs and charts</li>
                <li><strong>Get Recommendations:</strong> Receive personalized recommendations based on your previous workout performance</li>
                <li><strong>Share Plans:</strong> Share your workout plans with friends and import plans shared by others</li>
            </ul>
            <h3 style="font-size: 22px; margin-top: 30px; margin-bottom: 15px; font-weight: 600;">Why We Need Google User Data</h3>
            <p style="font-size: 17px; line-height: 1.7; margin-bottom: 20px; font-weight: 500;">
                <strong>Workout Tracker requires access to your Google account to provide its core functionality.</strong> Without Google Drive access, this application cannot function because all workout data must be stored in Google Sheets files. We request the following permissions and explain exactly why each is necessary:
            </p>
            <ul style="font-size: 16px; line-height: 1.9; margin-left: 20px; margin-bottom: 20px;">
                <li style="margin-bottom: 15px;"><strong>Google Drive API (drive.file scope):</strong> <strong>Why we need this:</strong> This application stores all workout data (exercises, sets, reps, weights, dates, workout plans) in Google Sheets files. We need Google Drive access to create these files in your Google Drive and to read/write your workout data. Without this permission, the application cannot save or retrieve any of your workout information. <strong>Important:</strong> We use the limited `drive.file` scope, which only allows us to access files that our application creates - we cannot access, view, or modify any other files in your Google Drive. All data is stored in sheets that you own and control in your own Google Drive.</li>
                <li style="margin-bottom: 15px;"><strong>User Email Address:</strong> <strong>Why we need this:</strong> We use your email address to identify which Google Sheets belong to your account. This is essential because if multiple users sign in on the same browser, each user's data must remain separate. Your email is also stored as metadata in workout plans to indicate who created them. Without your email, we cannot properly associate your workout data with your account.</li>
                <li style="margin-bottom: 15px;"><strong>User Profile Information (Name):</strong> <strong>Why we need this:</strong> We use your name to personalize your experience by displaying a welcome message when you sign in. This is optional but enhances the user experience. Without this, the app would still function but would not be able to provide personalized greetings.</li>
            </ul>
            
            <p style="font-size: 16px; line-height: 1.6; margin-bottom: 15px; background: rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 8px;">
                <strong>Data Ownership & Privacy:</strong> All your workout data is stored in Google Sheets files that are created in <strong>your own Google Drive</strong>. You maintain full ownership and control of this data. You can view, edit, delete, or share these files directly through Google Sheets or Google Drive at any time. We do not store, copy, or transfer your workout data to any external servers - everything remains in your Google Drive under your control.
            </p>
            
            <p style="font-size: 16px; line-height: 1.6; margin-bottom: 0;">
                <strong>Getting Started:</strong> Simply sign in with your Google account to get started. The application will automatically create the necessary Google Sheets in your Google Drive to begin tracking your fitness journey!
            </p>
        </div>

        <!-- Track Workout Tab -->
        <div id="track-tab" class="tab-content active">
            <div id="welcome-message" class="welcome-message" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <p style="font-size: 18px; margin: 0; font-weight: 600;" id="welcome-text"></p>
            </div>
            <div id="plan-mode-indicator" class="plan-mode-indicator" style="display: none;">
                <p><strong>Plan Mode Active:</strong> <span id="active-plan-name"></span></p>
            </div>
            <div class="session-controls" style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                <button id="start-session-btn" class="btn-primary" style="width: auto; padding: 10px 20px; display: none;">Start Session</button>
                <button id="save-workout" class="btn-primary" style="width: auto; padding: 10px 20px; display: none;">Save Exercise</button>
                <select id="select-plan-dropdown" class="plan-selector" style="display: none;">
                    <option value="">Select Plan...</option>
                </select>
            </div>
            <div class="workout-form">
                <div class="form-group">
                    <label for="exercise-name">Exercise Name</label>
                    <div class="exercise-name-container">
                        <select id="exercise-name" class="exercise-select">
                            <option value="">Select or type to add new...</option>
                        </select>
                        <input type="text" id="exercise-name-new" class="exercise-input-new" placeholder="New exercise name..." style="display: none;">
                        <button type="button" id="add-exercise-btn" class="btn-secondary exercise-add-btn">+ Add</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="sets">Sets</label>
                    <input type="number" id="sets" placeholder="3" min="1" max="10" value="3" inputmode="numeric" onfocus="this.select()" onclick="this.select()">
                </div>

                <div class="form-group">
                    <label>Reps and Weight for Each Set <small style="color: #999; font-weight: normal;">(can be different)</small></label>
                    <div id="reps-container"></div>
                </div>

                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" placeholder="Any additional notes..." rows="2"></textarea>
                </div>
            </div>

            <div id="rest-timer-modal" class="rest-timer-modal" style="display: none;">
                <div class="rest-timer-backdrop"></div>
                <div class="rest-timer-content">
                    <h3>‚è±Ô∏è Rest Timer</h3>
                    <div class="timer-display">
                        <div class="timer-circle">
                            <span id="timer-seconds">60</span>
                            <span class="timer-label">seconds</span>
                        </div>
                    </div>
                    <button id="skip-timer-btn" class="btn-secondary" style="margin-top: 10px;">Skip Rest</button>
                </div>
            </div>

            <div id="recommendations" class="recommendations-panel">
                <h3>üìä Recommendations</h3>
                <div id="recommendations-content">
                    <p class="no-data">Complete an exercise to see recommendations</p>
                </div>
            </div>

            <div id="today-workout" class="today-workout">
                <h3>Today's Workout</h3>
                <div id="today-exercises"></div>
            </div>
        </div>

        <!-- History & Graphs Tab -->
        <div id="history-tab" class="tab-content">
            <div class="history-controls">
                <select id="exercise-filter">
                    <option value="all">All Exercises</option>
                </select>
                <select id="time-filter">
                    <option value="7">Last 7 days</option>
                    <option value="30">Last 30 days</option>
                    <option value="90">Last 90 days</option>
                    <option value="365">Last year</option>
                    <option value="all">All time</option>
                </select>
            </div>

            <div class="chart-container">
                <canvas id="progress-chart"></canvas>
            </div>

            <div id="history-list" class="history-list">
                <h3>Recent Sessions</h3>
                <div id="history-content"></div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="config-tab" class="tab-content">
            <div class="config-section">
                <h3>Default Rest Timer</h3>
                <div class="form-group">
                    <label for="default-timer">Rest Timer Duration</label>
                    <div style="display: flex; align-items: center; gap: 15px; max-width: 400px; margin: 15px 0;">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                            <label style="font-size: 12px; color: #666; margin-bottom: 5px;">Minutes</label>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <button type="button" id="timer-inc-minutes" class="btn-secondary" style="width: 35px; height: 35px; padding: 0; font-size: 18px; border-radius: 5px;">+</button>
                                <input type="number" id="timer-minutes" min="0" max="59" value="1" style="width: 70px; text-align: center; padding: 8px; font-size: 18px; border: 2px solid #e0e0e0; border-radius: 5px;">
                                <button type="button" id="timer-dec-minutes" class="btn-secondary" style="width: 35px; height: 35px; padding: 0; font-size: 18px; border-radius: 5px;">‚àí</button>
                            </div>
                        </div>
                        <span style="font-size: 24px; font-weight: bold; color: #667eea; margin-top: 20px;">:</span>
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                            <label style="font-size: 12px; color: #666; margin-bottom: 5px;">Seconds</label>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <button type="button" id="timer-inc-seconds" class="btn-secondary" style="width: 35px; height: 35px; padding: 0; font-size: 18px; border-radius: 5px;">+</button>
                                <input type="number" id="default-timer-seconds" min="0" max="59" value="0" style="width: 70px; text-align: center; padding: 8px; font-size: 18px; border: 2px solid #e0e0e0; border-radius: 5px;">
                                <button type="button" id="timer-dec-seconds" class="btn-secondary" style="width: 35px; height: 35px; padding: 0; font-size: 18px; border-radius: 5px;">‚àí</button>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="default-timer" value="1:00">
                </div>
                <button id="save-default-timer" class="btn-primary">Save Default Timer</button>
            </div>

            <div class="config-section">
                <h3>Exercise Configuration</h3>
                <div id="exercise-config-list"></div>
                
                <div class="config-section">
                    <button id="add-exercise-config" class="btn-primary">+ Add New Exercise</button>
                </div>
            </div>

            <div class="config-section">
                <h3>Progress Sharing</h3>
                <p style="color: #666; margin-bottom: 15px;">Manage which trainers can see your workout progress</p>
                <div id="progress-sharing-list"></div>
            </div>
        </div>

        <!-- Plan Mode Tab -->
        <div id="plan-tab" class="tab-content">
            <div id="plan-indicator" class="plan-indicator" style="display: none;">
                <div class="plan-indicator-content">
                    <span id="current-plan-name"></span>
                    <button id="clear-plan-btn" class="btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-left: 10px;">Clear Plan</button>
                </div>
            </div>

            <div class="config-section">
                <h3>Workout Plans</h3>
                <div id="plans-list"></div>
                
                <div class="config-section">
                    <h4 id="plan-form-title">Create New Plan</h4>
                    <div class="form-group">
                        <label for="plan-name">Plan Name</label>
                        <input type="text" id="plan-name" placeholder="e.g., Leg Day, Chest Day">
                    </div>
                    <div class="form-group">
                        <label for="plan-slots-count">Number of Exercise Slots</label>
                        <input type="number" id="plan-slots-count" min="1" max="20" value="5" placeholder="5">
                    </div>
                    <div class="form-group">
                        <button id="generate-slots-btn" class="btn-secondary">Generate Exercise Slots</button>
                    </div>
                    <div id="plan-exercise-slots"></div>
                    <div class="form-group" style="margin-top: 15px;">
                        <button id="save-plan-btn" class="btn-primary" style="display: none;">Save Plan</button>
                        <button id="cancel-plan-btn" class="btn-secondary" style="display: none; margin-left: 10px;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Plan Followers Tab -->
        <div id="followers-tab" class="tab-content">
            <div class="config-section">
                <h3>My Plan Followers</h3>
                <p style="color: #666; margin-bottom: 20px;">View people who are using your shared workout plans</p>
                <div id="followers-list"></div>
            </div>
        </div>

    </div>

    <footer style="text-align: center; padding: 20px; color: #666; font-size: 12px; border-top: 1px solid #e0e0e0; margin-top: 20px;">
        <p style="margin-bottom: 8px;">
            <a href="privacy-policy.html" style="color: #667eea; text-decoration: none; margin: 0 10px;">Privacy Policy</a>
            <span style="color: #ccc;">|</span>
            <a href="terms-of-service.html" style="color: #667eea; text-decoration: none; margin: 0 10px;">Terms of Service</a>
        </p>
        <p style="color: #999; margin: 0;">¬© 2024 Workout Tracker</p>
    </footer>

    <!-- Victory Modal -->
    <div id="victory-modal" class="victory-modal" style="display: none;">
        <div class="victory-backdrop"></div>
        <div class="victory-content">
            <div class="victory-icon">üèÜ</div>
            <h2 class="victory-title">Plan Complete!</h2>
            <p class="victory-message" id="victory-plan-name"></p>
            <p class="victory-subtitle">You've completed all exercises in your workout plan!</p>
            <button id="victory-close-btn" class="btn-primary victory-button">Awesome!</button>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
